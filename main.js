!function(t){function e(e){for(var a,i,n=e[0],r=e[1],o=0,c=[];o<n.length;o++)i=n[o],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&c.push(s[i][0]),s[i]=0;for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a]);for(h&&h(e);c.length;)c.shift()()}var a={},s={0:0};function i(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.e=function(t){var e=[],a=s[t];if(0!==a)if(a)e.push(a[2]);else{var n=new Promise((function(e,i){a=s[t]=[e,i]}));e.push(a[2]=n);var r,o=document.createElement("script");o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.src=function(t){return i.p+""+t+".main.js"}(t);var h=new Error;r=function(e){o.onerror=o.onload=null,clearTimeout(c);var a=s[t];if(0!==a){if(a){var i=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src;h.message="Loading chunk "+t+" failed.\n("+i+": "+n+")",h.name="ChunkLoadError",h.type=i,h.request=n,a[1](h)}s[t]=void 0}};var c=setTimeout((function(){r({type:"timeout",target:o})}),12e4);o.onerror=o.onload=r,document.head.appendChild(o)}return Promise.all(e)},i.m=t,i.c=a,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(a,s,function(e){return t[e]}.bind(null,s));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i.oe=function(t){throw console.error(t),t};var n=window.webpackJsonp=window.webpackJsonp||[],r=n.push.bind(n);n.push=e,n=n.slice();for(var o=0;o<n.length;o++)e(n[o]);var h=r;i(i.s=9)}([function(t,e,a){t.exports=a.p+"assets/images/title_bombers.png"},function(t,e,a){t.exports=a.p+"assets/images/chemin.png"},function(t,e,a){t.exports=a.p+"assets/images/arena_wall.png"},function(t,e,a){t.exports=a.p+"assets/images/arena_bomber_walk.png"},function(t,e,a){t.exports=a.p+"assets/images/arena_bomber_death.png"},function(t,e,a){t.exports=a.p+"assets/images/arena_bomb.png"},function(t,e,a){t.exports=a.p+"assets/images/arena_flame.png"},function(t,e,a){t.exports=a.p+"assets/images/arena_item.png"},function(t,e,a){t.exports=a.p+"assets/images/winner_bomber.png"},function(t,e,a){"use strict";a.r(e);var s=a(0),i=a.n(s),n=a(1),r=a.n(n),o=a(2),h=a.n(o),c=a(3),l=a.n(c),d=a(4),u=a.n(d),m=a(5),p=a.n(m),y=a(6),g=a.n(y),f=a(7),E=a.n(f),x=a(8),b=a.n(x);class w{static titleWallpaper(){return this.titleImage?this.titleImage:(this.titleImage=new Image,this.titleImage.src=i.a,this.titleImage)}static ground(){return this.groundImage?this.groundImage:(this.groundImage=new Image,this.groundImage.src=r.a,this.groundImage)}static wall(){return this.wallImage?this.wallImage:(this.wallImage=new Image,this.wallImage.src=h.a,this.wallImage.width=32,this.wallImage.height=32,this.wallImage)}static characterAlive(){return this.characterAliveImage?this.characterAliveImage:(this.characterAliveImage=new Image,this.characterAliveImage.src=l.a,this.characterAliveImage.width=43,this.characterAliveImage.height=45,this.characterAliveImage)}static characterDead(){return this.characterDeadImage?this.characterDeadImage:(this.characterDeadImage=new Image,this.characterDeadImage.src=u.a,this.characterDeadImage.width=517/12,this.characterDeadImage.height=316/7,this.characterDeadImage)}static bomb(){return this.bombImage?this.bombImage:(this.bombImage=new Image,this.bombImage.src=p.a,this.bombImage.width=100/3,this.bombImage.height=34,this.bombImage)}static flame(){return this.flameImage?this.flameImage:(this.flameImage=new Image,this.flameImage.src=g.a,this.flameImage.width=925/28,this.flameImage.height=34,this.flameImage)}static bonus(){return this.itemImage?this.itemImage:(this.itemImage=new Image,this.itemImage.src=E.a,this.itemImage.width=529/16,this.itemImage.height=34,this.itemImage)}static characterVictory(){return this.imageVictory?this.imageVictory:(this.imageVictory=new Image,this.imageVictory.width=25.25,this.imageVictory.height=33.2,this.imageVictory.src=b.a,this.imageVictory)}}const I={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",ENTER:"ENTER",ADD_PLAYER:"ADD_PLAYER",MENU_OVERFLOW:"MENU_OVERFLOW",RESET:"RESET",ADD_BLAST:"ADD_BLAST",BLAST_VANISHED:"BLAST_VANISHED",DROP_BOMB:"DROP_BOMB",BOMB_EXPLODED:"BOMB_EXPLODED",DESTROY:"DESTROY",KILL:"KILL",VICTORY:"VICTORY",INIT_GAME:"INIT_GAME",BONUS_EXPLODED:"BONUS_EXPLODED",GET_BONUS:"GET_BONUS",MOVE:"MOVE"};Object.freeze(I);const O={WHITE:0,BLACK:1,RED:2,BLUE:3,GREEN:4};Object.freeze(O);const T={INITIALISATION:"INITIALISATION",READY:"READY",IN_PROGRESS:"IN_PROGRESS",END:"END"};class S{constructor(){this.imageTitlePosition=800,this.fontSize=30,this.selectedOption=1,this.playersDilayed=[],document.addEventListener("state",t=>{this.playersDilayed=t.detail.characters})}update(t){this.render(t)}render(t){if(t.ctx.fillStyle="rgb(52,173,98)",t.ctx.fillRect(0,400,t.screenWidth,t.screenHeight),t.ctx.fillStyle="lightblue",t.ctx.fillRect(0,0,t.screenWidth,400),this.playersDilayed&&0===this.playersDilayed.length)t.ctx.font="20px Bomberman",t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="red",t.ctx.fillText("Connect 2 controllers",t.screenWidth/2+5,20);else{let e=100;t.ctx.font="25px Bomberman",t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="red",this.playersDilayed.forEach((a,s)=>{s===O.WHITE&&(t.ctx.fillStyle="white"),s===O.BLACK&&(t.ctx.fillStyle="black"),s===O.RED&&(t.ctx.fillStyle="red"),s===O.BLUE&&(t.ctx.fillStyle="blue"),t.ctx.fillText("Player "+(s+1),100+e,20),e+=200})}this.imageTitlePosition>170&&(this.imageTitlePosition-=15),t.ctx.drawImage(w.titleWallpaper(),0,this.imageTitlePosition+5,t.screenWidth,t.screenHeight-160),this.fontSize<90&&this.fontSize++,t.ctx.font=this.fontSize+"px Bomberman",t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="gray",t.ctx.fillText("Bomberman.js",t.screenWidth/2+5,85),t.ctx.fillStyle="rgb(250, 250, 250)",t.ctx.fillText("Bomberman.js",t.screenWidth/2,80),t.ctx.font="20px Bomberman",t.ctx.fillStyle="rgb(250, 250, 250)",t.ctx.textAlign="center",t.ctx.textBaseline="center",t.ctx.fillText("Credit : Freuhlon",t.screenWidth/2,this.imageTitlePosition+440)}manageOverflowMenu(t,e,a){this.selectedOption=a,a>e&&(this.selectedOption=e,document.dispatchEvent(new CustomEvent("action",{detail:{type:I.MENU_OVERFLOW,payload:{selectedOption:this.selectedOption}}}))),a<t&&(this.selectedOption=t,document.dispatchEvent(new CustomEvent("action",{detail:{type:I.MENU_OVERFLOW,payload:{selectedOption:this.selectedOption}}})))}static getNewScreen(t,e,a){if("TITLE"===e){if(1===t&&a===T.READY)return"NEW_GAME";if(2===t)return"OPTIONS"}if("OPTIONS"===e)return"TITLE"}}class D extends S{constructor(){super(),this.code="TITLE",this.ready=!1,document.addEventListener("state",t=>{this.manageOverflowMenu(1,2,t.detail.selectedOption),this.ready=t.detail.gameStatus===T.READY})}render(t){super.render(t),t.ctx.font="60px Bomberman",t.ctx.fillStyle=this.getColorMenu("New Game"),t.ctx.fillText("New Game",t.screenWidth/2,330),t.ctx.fillStyle=this.getColorMenu("Options"),t.ctx.fillText("Options",t.screenWidth/2,420)}getColorMenu(t){return"New Game"===t&&1===this.selectedOption&&this.ready?"yellow":"New Game"!==t||1!==this.selectedOption||this.ready?"Options"===t&&2===this.selectedOption?"yellow":"rgb(250, 250, 250)":"rgb(169,169,169)"}}class v{constructor(t){this.character=t,this.x=t.x,this.y=t.y,this.animationState=0,this.animationDuration=16,this.timeElapsed=0,this.time=0,this.accelerator=30,this.timer=128}render(t){this.time++;let e=0;if((e=Math.floor(this.animationState/this.animationDuration))>2&&(e%=3),this.animationState++,this.timeElapsed++>this.accelerator){if(this.animationDuration<4){const t=this,e=this.character;document.dispatchEvent(new CustomEvent("action",{detail:{type:I.ADD_BLAST,payload:{bomb:t,character:e}}})),document.dispatchEvent(new CustomEvent("action",{detail:{type:I.BOMB_EXPLODED,payload:{bomb:t}}}))}this.animationDuration=this.animationDuration/2,this.timeElapsed=0}t.ctx.drawImage(w.bomb(),e*w.bomb().width,0,w.bomb().width,w.bomb().height,32*this.x+4,32*this.y+6,32/1.5,32/1.5)}}class A{constructor(t,e,a,s){this.x=t,this.y=e,this.power=a,this.cardinal=s}render(t){t.ctx.drawImage(w.flame(),w.flame().width*this.cardinal-this.power*w.flame().width,0,w.flame().width,w.flame().height,32*this.x,32*this.y,34,34)}}const L={MIDDLE:27,NORTH_MIDDLE:3,EAST_MIDDLE:7,SOUTH_MIDDLE:3,WEST_MIDDLE:7,NORTH_END:11,EAST_END:23,SOUTH_END:19,WEST_END:15};Object.freeze(L);const R={ALIVE:"ALIVE",VICTORIOUS:"VICTORIOUS",DEAD:"DEAD"};Object.freeze(R);class N{constructor(t,e,a,s,i,n,r){this.walls=s,this.map=a,this.x=t.x,this.y=t.y,this.animationState=0,this.time=0,this.radius=e.radius,this.timer=20,this.flames=[],this.bombs=i,this.characters=n,this.character=e,this.bonus=r,this.canPropagate={north:!0,east:!0,south:!0,west:!0}}render(t){let e=this.radius;if(this.animationState++,this.time++>this.timer){const t=this;document.dispatchEvent(new CustomEvent("action",{detail:{type:I.BLAST_VANISHED,payload:{blast:t}}}))}let a=this.computePower();this.animationState<=this.radius&&(e=this.animationState),this.flames.push(new A(this.x,this.y,a,L.MIDDLE)),this.computeNorth(e,a,this.canPropagate.north),this.computeEast(e,a,this.canPropagate.east),this.computeSouth(e,a,this.canPropagate.south),this.computeWest(e,a,this.canPropagate.west),this.flames.forEach(e=>{e.render(t),this.bombs.forEach(t=>{t.x===e.x&&t.y===e.y&&(document.dispatchEvent(new CustomEvent("action",{detail:{type:I.ADD_BLAST,payload:{bomb:t,character:t.character}}})),document.dispatchEvent(new CustomEvent("action",{detail:{type:I.BOMB_EXPLODED,payload:{bomb:t}}})))}),this.bonus.forEach(t=>{t.x===e.x&&t.y===e.y&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.BONUS_EXPLODED,payload:{item:t}}}))}),this.characters.forEach(t=>{t.x===e.x&&t.y===e.y&&t.status===R.ALIVE&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.KILL,payload:{character:t}}}))})})}computeNorth(t,e){let a=1;for(;a<this.radius;){const t=2===this.map[this.y-a][this.x]&&this.canPropagate.north,s=this.walls[this.x][this.y-a]&&!this.walls[this.x][this.y-a].destroyed;if(!t)break;s&&t?(this.canPropagate.north=!1,this.flames.push(new A(this.x,this.y-a,e,L.NORTH_END)),document.dispatchEvent(new CustomEvent("action",{detail:{type:I.DESTROY,payload:{destroyedX:this.x,destroyedY:this.y-1}}}))):!s&&t&&(a+1===this.radius?this.flames.push(new A(this.x,this.y-a,e,L.NORTH_END)):this.flames.push(new A(this.x,this.y-a,e,L.NORTH_MIDDLE))),a++}}computeEast(t,e){let a=1;for(;a<this.radius;){const t=2===this.map[this.y][this.x+a]&&this.canPropagate.east,s=this.walls[this.x+a][this.y]&&!this.walls[this.x+a][this.y].destroyed;if(!t)break;t&&s?(this.canPropagate.east=!1,this.flames.push(new A(this.x+a,this.y,e,L.EAST_END)),document.dispatchEvent(new CustomEvent("action",{detail:{type:I.DESTROY,payload:{destroyedX:this.x+a,destroyedY:this.y}}}))):t&&!s&&(a+1===this.radius?this.flames.push(new A(this.x+a,this.y,e,L.EAST_END)):this.flames.push(new A(this.x+a,this.y,e,L.EAST_MIDDLE))),a++}}computeSouth(t,e){let a=1;for(;a<this.radius;){const t=2===this.map[this.y+a][this.x]&&this.canPropagate.south,s=this.walls[this.x][this.y+a]&&!this.walls[this.x][this.y+a].destroyed;if(!t)break;t&&s?(this.canPropagate.south=!1,this.flames.push(new A(this.x,this.y+a,e,L.SOUTH_END)),document.dispatchEvent(new CustomEvent("action",{detail:{type:I.DESTROY,payload:{destroyedX:this.x,destroyedY:this.y+a}}}))):t&&!s&&(a+1===this.radius?this.flames.push(new A(this.x,this.y+a,e,L.SOUTH_END)):this.flames.push(new A(this.x,this.y+a,e,L.SOUTH_MIDDLE))),a++}}computeWest(t,e){let a=1;for(;a<this.radius;){const t=2===this.map[this.y][this.x-a]&&this.canPropagate.west,s=this.walls[this.x-a][this.y]&&!this.walls[this.x-a][this.y].destroyed;if(!t)break;t&&s?(this.canPropagate.west=!1,this.flames.push(new A(this.x-a,this.y,e,L.WEST_END)),document.dispatchEvent(new CustomEvent("action",{detail:{type:I.DESTROY,payload:{destroyedX:this.x-a,destroyedY:this.y}}}))):t&&!s&&(a+1===this.radius?this.flames.push(new A(this.x-a,this.y,e,L.WEST_END)):this.flames.push(new A(this.x-a,this.y,e,L.WEST_MIDDLE))),a++}}computePower(){let t=0;switch(this.radius){case 1:case 2:t=0;break;case 3:case 4:t=1;break;case 5:case 6:t=2}return t}}const _={DOWN:1,LEFT:7,RIGHT:4,TOP:10};Object.freeze(_);class C{constructor(t,e,a,s,i){this.x=e,this.y=a,this.direction=s,this.animationState=-1,this.color=t,this.radius=2,this.status=R.ALIVE,this.offsetX=0,this.offsetY=0,this.animationDuration=15,this.bombMax=1,this.bombUsed=0,this.pixelsToTreat=0,this.gamePadIndex=i,this.nextFrame=this.getNextFrame(s),document.addEventListener("state",t=>{this.bonus=t.detail.bonus;const e=t.detail.characters.find(e=>e.color===t.detail.currentPlayerColor);e&&(this.radius=e.radius,this.animationDuration=e.animationDuration,this.bombMax=e.bombMax)})}render(t){switch(this.status){case R.ALIVE:this.renderAlive(t);break;case R.DEAD:this.renderDead(t);break;case R.VICTORIOUS:this.renderVictory(t)}}renderAlive(t){let e=1;this.animationState>=this.animationDuration?this.animationState=-1:this.animationState>=0&&((e=Math.floor(this.animationState/8))>3&&(e%=4),this.pixelsToTreat=32-this.animationState/this.animationDuration*32,this.pixelsToTreat<16&&(this.x=this.nextFrame.x,this.y=this.nextFrame.y),this.direction===_.TOP?this.offsetY=this.pixelsToTreat:this.direction===_.DOWN?this.offsetY=-this.pixelsToTreat:this.direction===_.LEFT?this.offsetX=this.pixelsToTreat:this.direction===_.RIGHT&&(this.offsetX=-this.pixelsToTreat),this.animationState++);let a,s;-1!==this.animationState?(a=32*this.nextFrame.x+this.offsetX,s=32*this.nextFrame.y-8+this.offsetY):(a=32*this.x+this.offsetX,s=32*this.y-8+this.offsetY),t.ctx.drawImage(w.characterAlive(),w.characterAlive().width*((()=>{switch(e){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}})()+this.direction),w.characterAlive().height*this.color,w.characterAlive().width,w.characterAlive().height,a,s,32,32)}getNextFrame(t){let e={x:this.x,y:this.y};switch(t){case _.DOWN:e.y++;break;case _.LEFT:e.x--;break;case _.RIGHT:e.x++;break;case _.TOP:e.y--}return e}move(t,e){if(!(this.animationState>=0)&&t&&(this.direction=t,this.nextFrame=this.getNextFrame(t),!(this.nextFrame.x<0||this.nextFrame.y<0||this.nextFrame.x>=e.map[0].length||this.nextFrame.y>=e.map.length)&&2===e.map[this.nextFrame.y][this.nextFrame.x]&&(!e.walls[this.nextFrame.x][this.nextFrame.y]||e.walls[this.nextFrame.x][this.nextFrame.y].destroyed))){this.bonus.forEach(t=>{t.x===this.nextFrame.x&&t.y===this.nextFrame.y&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.GET_BONUS,payload:{bonus:t,playerColor:this.color}}}))});for(let t in e.bombs)if(e.bombs[t].x===this.nextFrame.x&&e.bombs[t].y===this.nextFrame.y)return;this.animationState=1}}renderDead(t){this.status===R.ALIVE&&(this.status=R.DEAD,this.animationState=0),t.ctx.drawImage(w.characterDead(),w.characterDead().width*Math.floor(this.animationState/10),w.characterDead().height*this.color,w.characterDead().width,w.characterDead().height,32*this.x,32*this.y,32,32),this.animationState++}renderVictory(t){let e=1;e=Math.floor(this.animationState/this.animationDuration)%2==0?0:1,t.ctx.drawImage(w.characterVictory(),w.characterVictory().width*e,w.characterVictory().height*this.color,w.characterVictory().width,w.characterVictory().height,32*this.x,32*this.y,32,32),this.animationState++}}const B={BOMB:0,POWER:1,SPEED:3};Object.freeze(B);class P{static menu(){return a.e(8).then(a.t.bind(null,10,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a.loop=!0,a})}static menuNext(){return a.e(6).then(a.t.bind(null,11,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}static menuPrevious(){return a.e(7).then(a.t.bind(null,12,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}static menuBeep(){return a.e(5).then(a.t.bind(null,13,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}static bombDrop(){return a.e(2).then(a.t.bind(null,14,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}static death(){return a.e(1).then(a.t.bind(null,15,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}static explosion(){return a.e(4).then(a.t.bind(null,16,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}static bonus(){return a.e(3).then(a.t.bind(null,17,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}static win(){return a.e(9).then(a.t.bind(null,18,7)).then(t=>{const e=t.default,a=new Audio(e);return a.load(),a})}}class M extends S{constructor(){super(),this.code="OPTIONS",document.addEventListener("state",t=>{this.manageOverflowMenu(1,2,t.detail.selectedOption)})}render(t){super.render(t),t.ctx.font="50px Bomberman",t.ctx.fillStyle=this.getColorMenu("Sound"),t.ctx.fillText(" Sound : yes",t.screenWidth/2,330),t.ctx.fillStyle=this.getColorMenu("Retour"),t.ctx.fillText("Retour",t.screenWidth/2,420)}getColorMenu(t){return"Sound"===t&&1===this.selectedOption||"Retour"===t&&2===this.selectedOption?"yellow":"rgb(250, 250, 250)"}}class k{constructor(t){this.canvasContext=t}render(t,e){this.canvasContext.ctx.drawImage(w.ground(),0,0,32,32,32*e,32*t,32,32)}}class W{constructor(t,e){this.type=t,this.canvasContext=e}render(t,e){switch(this.type){case"UP_LEFT":this.canvasContext.ctx.drawImage(w.ground(),96,64,32,32,32*e,32*t,32,32);break;case"UP_RIGHT":this.canvasContext.ctx.drawImage(w.ground(),96,96,32,32,32*e,0,32,32);break;case"BOTTOM_LEFT":this.canvasContext.ctx.drawImage(w.ground(),96,32,32,32,0,32*t,32,32);break;case"UP":this.canvasContext.ctx.drawImage(w.ground(),32,96,32,32,32*e,0,32,32);break;case"BOTTOM_RIGHT":this.canvasContext.ctx.drawImage(w.ground(),96,0,32,32,32*e,32*t,32,32);break;case"BOTTOM":this.canvasContext.ctx.drawImage(w.ground(),32,32,32,32,32*e,32*t,32,32);break;case"LEFT":this.canvasContext.ctx.drawImage(w.ground(),64,64,32,32,32*e,32*t,32,32);break;case"RIGHT":this.canvasContext.ctx.drawImage(w.ground(),0,64,32,32,32*e,32*t,32,32)}}}class V{constructor(t){this.canvasContext=t}render(t,e){this.canvasContext.ctx.drawImage(w.ground(),32,64,32,32,32*e,32*t,32,32)}}class U{constructor(t,e,a,s){this.map=t,this.characters=a,this.walls=e,this.bonus=s,this.bombs=[],this.blasts=[],this.code="NEW_GAME",document.addEventListener("state",t=>{this.walls=t.detail.walls,this.characters=t.detail.characters,this.bonus=t.detail.bonus,this.bombs=t.detail.bombs,this.blasts=t.detail.blasts,this.map=t.detail.map})}update(t){this.render(t)}render(t){const e=document.getElementById("canvas");e.width=this.map[0]&&32*this.map[0].length,e.height=32*this.map.length,t.screenWidth=e.width,t.screenHeight=e.height,t.ctx.fillStyle="black",t.ctx.fillRect(0,0,t.screenWidth,t.screenHeight),this.ground=new k(t),this.frameUpLeft=new W("UP_LEFT",t),this.frameUpRight=new W("UP_RIGHT",t),this.frameUp=new W("UP",t),this.frameBottomLeft=new W("BOTTOM_LEFT",t),this.frameBottomRight=new W("BOTTOM_RIGHT",t),this.frameBottom=new W("BOTTOM",t),this.frameLeft=new W("LEFT",t),this.frameRight=new W("RIGHT",t),this.block=new V(t);for(let t=0,e=this.map.length;t<e;t++)for(let e=0,a=this.map[t].length;e<a;e++)switch(this.map[t][e]){case 2:this.ground.render(t,e);break;case 12:this.frameUpLeft.render(t,e);break;case 14:this.frameUp.render(t,e);break;case 16:this.frameUpRight.render(t,e);break;case 8:this.frameBottomLeft.render(t,e);break;case 4:this.frameBottomRight.render(t,e);break;case 6:this.frameBottom.render(t,e);break;case 11:this.frameLeft.render(t,e);break;case 9:this.frameRight.render(t,e);break;case 10:this.block.render(t,e)}this.bonus.forEach(e=>{e.render(t)});for(let e=0,a=this.walls.length;e<a;e++)for(let a=0,s=this.walls[e].length;a<s;a++)this.walls[e][a]&&this.walls[e][a].render(t);this.bombs.forEach(e=>{e.render(t)}),this.blasts.forEach(e=>{e.render(t)}),this.characters.forEach(e=>{e.render(t)}),this.computeVictory(this.characters)}computeVictory(t){const e=this.characters.filter(t=>t.status===R.ALIVE);1===e.length&&e[0].status!==R.VICTORY&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.VICTORY,payload:{character:e[0]}}}))}}class F{constructor(t,e,a){this.x=t,this.y=e,this.animationState=0,this.animationDuration=6,this.destroyed=a}render(t){let e=0;this.destroyed&&(e=Math.floor(this.animationState/this.animationDuration),this.animationState++),t.ctx.drawImage(w.wall(),e*w.wall().width,0,w.wall().width,w.wall().height,32*this.x,32*this.y,32,32)}}class G{constructor(t,e,a){this.type=a,this.x=t,this.y=e,this.etatAnimation=0,this.dureeAnimation=16}render(t){let e=Math.floor(this.etatAnimation/this.dureeAnimation);e>1&&(e%=2),t.ctx.drawImage(w.bonus(),(e+2*this.type)*w.bonus().width,0,w.bonus().width,w.bonus().height,32*this.x+4,32*this.y+6,32/1.5,32/1.5),this.etatAnimation++}}class H{constructor(){}static initWalls(t,e){let a=[];for(let e=0,s=t[0].length;e<s;e++){a[e]=[];for(let s=0,i=t.length;s<i;s++)2===t[s][e]&&this.getRandomInt(11)>1&&(a[e][s]=new F(e,s))}return e.forEach(t=>{a[t.x]&&a[t.x][t.y]&&(a[t.x][t.y]=null),a[t.x-1]&&a[t.x-1][t.y]&&(a[t.x-1][t.y]=null),a[t.x]&&a[t.x][t.y-1]&&(a[t.x][t.y-1]=null),a[t.x+1]&&a[t.x+1][t.y]&&(a[t.x+1][t.y]=null),a[t.x]&&a[t.x][t.y+1]&&(a[t.x][t.y+1]=null)}),a}static initBonus(t,e){const a=[],s=[];e.map(t=>({x:t.x,y:t.y})).forEach(t=>{s.push(t.x.toString()+t.y.toString()),s.push((t.x-1).toString()+t.y.toString()),s.push(t.x.toString()+(t.y-1).toString()),s.push((t.x+1).toString()+t.y.toString()),s.push(t.x.toString()+(t.y+1).toString())});for(let e=0,i=t[0].length;e<i;e++)for(let i=0,n=t.length;i<n;i++)if(2===t[i][e]){let t=this.getRandomInt(20);if(s.includes(e.toString()+i.toString()))continue;switch(t){case 1:a.push(new G(e,i,B.BOMB));break;case 10:a.push(new G(e,i,B.POWER))}}return a}static getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}}const Y=document.getElementById("canvas");Y.width=960,Y.height=640;const K={screenWidth:960,screenHeight:640,ctx:Y.getContext("2d")};(new class{constructor(){this.initialState()}initialState(){this.state={gameStatus:T.INITIALISATION,selectedOption:1,currentScreenCode:"TITLE",map:[[12,14,14,14,14,14,14,14,14,14,14,14,14,14,16],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[8,6,6,6,6,6,6,6,6,6,6,6,6,6,4]],characters:[],bonus:[],bombs:[],walls:[],blasts:[]}}createStore(){const t=this;document.addEventListener("action",(function(e){t.state=t.reducer(t.state,e.detail),document.dispatchEvent(new CustomEvent("state",{detail:t.state}))}),!1)}reducer(t,e){if(!t)return this.initialState();switch(e.type){case I.UP:return P.menuBeep().then(t=>t.play()),{...t,selectedOption:t.selectedOption-1};case I.DOWN:return P.menuBeep().then(t=>t.play()),{...t,selectedOption:t.selectedOption+1};case I.LEFT:case I.RIGHT:return P.menuBeep().then(t=>t.play()),t;case I.ENTER:let a=S.getNewScreen(t.selectedOption,t.currentScreenCode,t.gameStatus);return"TITLE"===a&&[T.INITIALISATION,T.READY].includes(t.gameStatus)?P.menuPrevious().then(t=>t.play()):P.menuNext().then(t=>t.play()),{...t,selectedOption:1,currentScreenCode:a};case I.ADD_PLAYER:const s=t.characters;let i=t.gameStatus;if([T.INITIALISATION,T.READY].includes(i)){if(!s.find(t=>t.color===e.payload.index))switch(e.payload.index){case O.WHITE:s.push(new C(O.WHITE,1,1,_.DOWN));break;case O.BLACK:s.push(new C(O.BLACK,1,11,_.DOWN));break;case O.BLUE:s.push(new C(O.BLUE,13,1,_.DOWN));break;case O.RED:s.push(new C(O.RED,13,11,_.DOWN))}s.length>=2&&(i=T.READY)}return{...t,characters:s,gameStatus:i};case I.MENU_OVERFLOW:return{...t,selectedOption:e.payload.selectedOption};case I.RESET:return setTimeout((function(){location.reload()}),100),this.state;case I.ADD_BLAST:return t.blasts.push(new N(e.payload.bomb,e.payload.character,t.map,t.walls,t.bombs,t.characters,t.bonus)),{...t};case I.BLAST_VANISHED:return t.blasts.splice(t.blasts.indexOf(e.payload.blast),1),{...t};case I.DROP_BOMB:if(t.gameStatus===T.IN_PROGRESS){if(t.characters.find(t=>t.color===e.payload.color).bombUsed<t.characters.find(t=>t.color===e.payload.color).bombMax){t.characters.find(t=>t.color===e.payload.color).bombUsed++;let a=new v(t.characters.find(t=>t.color===e.payload.color));t.bombs.push(a),P.bombDrop().then(t=>t.play())}}return{...t};case I.BOMB_EXPLODED:return t.characters.find(t=>t.color===e.payload.bomb.character.color).bombUsed--,t.bombs.splice(t.bombs.indexOf(e.payload.bomb),1),P.explosion().then(t=>t.play()),{...t};case I.DESTROY:return t.walls[e.payload.destroyedX][e.payload.destroyedY].destroyed=!0,{...t};case I.KILL:return t.characters.find(t=>t.color===e.payload.character.color).status=R.DEAD,P.death().then(t=>t.play()),{...t};case I.VICTORY:return t.characters.find(t=>t.color===e.payload.character.color).status=R.VICTORIOUS,P.win().then(t=>t.play()),{...t,gameStatus:T.END};case I.INIT_GAME:return{...t,gameStatus:T.IN_PROGRESS,currentScreenCode:e.payload.currentScreenCode,walls:e.payload.walls,bonus:e.payload.bonus};case I.GET_BONUS:switch(e.payload.bonus.type){case B.POWER:t.characters.find(t=>t.color===e.payload.playerColor).radius++;break;case B.BOMB:t.characters.find(t=>t.color===e.payload.playerColor).bombMax++;break;case B.SPEED:const a=t.characters.find(t=>t.color===e.payload.playerColor);t.characters.find(t=>t.color===e.payload.playerColor)>8&&(t.characters.find(t=>t.color===e.payload.playerColor).animationDuration=a.animationDuration-1)}const n=t.bonus.find(t=>t.x===e.payload.bonus.x&&t.y===e.payload.bonus.y);return t.bonus.splice(t.bonus.indexOf(n),1),P.bonus().then(t=>t.play()),{...t};case I.MOVE:return t.gameStatus===T.IN_PROGRESS&&t.characters.find(t=>t.color===e.payload.color).move(e.payload.direction,t),{...t};case I.BONUS_EXPLODED:{const a=t.bonus.find(t=>t.x===e.payload.item.x&&t.y===e.payload.item.y);return t.bonus.splice(t.bonus.indexOf(a),1),{...t}}}}}).createStore(),(new class{constructor(){this.keys={up:38,down:40,left:37,right:39,space:32,enter:13,escape:27},this.handledKeys=[],this.handledKeys[this.keys.up]=!1,this.handledKeys[this.keys.down]=!1,this.handledKeys[this.keys.left]=!1,this.handledKeys[this.keys.right]=!1,this.handledKeys[this.keys.space]=!1,this.handledKeys[this.keys.enter]=!1,this.handledKeys[this.keys.escape]=!1}bind(){const t=this;addEventListener("keyup",(function(e){delete t.handledKeys[e.keyCode]}),!1),addEventListener("keydown",(function(e){switch(t.handledKeys[e.keyCode]&&(t.handledKeys[e.keyCode]=!0),e.keyCode){case t.keys.up:document.dispatchEvent(new CustomEvent("action",{detail:{type:I.UP}}));break;case t.keys.down:document.dispatchEvent(new CustomEvent("action",{detail:{type:I.DOWN}}));break;case t.keys.enter:document.dispatchEvent(new CustomEvent("action",{detail:{type:I.ENTER}}));break;case t.keys.escape:document.dispatchEvent(new CustomEvent("action",{detail:{type:I.RESET}}));break;case t.keys.left:document.dispatchEvent(new CustomEvent("action",{detail:{type:I.LEFT}}));break;case t.keys.right:document.dispatchEvent(new CustomEvent("action",{detail:{type:I.RIGHT}}))}}),!1)}}).bind();const X=new class{constructor(){this.toucheds=[!1,!1,!1,!1],window.addEventListener("gamepadconnected",(function(t){document.dispatchEvent(new CustomEvent("action",{detail:{type:I.ADD_PLAYER,payload:{index:t.gamepad.index}}}))}),!1),window.addEventListener("gamepaddisconnected",(function(t){}),!1)}listen(){[navigator.getGamepads()[0],navigator.getGamepads()[1],navigator.getGamepads()[2],navigator.getGamepads()[3]].filter(t=>!!t).forEach((t,e)=>{t.buttons[0].pressed&&!this.toucheds[e]?(this.toucheds[e]=!0,document.dispatchEvent(new CustomEvent("action",{detail:{type:I.DROP_BOMB,payload:{color:e}}}))):!t.buttons[0].pressed&&this.toucheds[e]&&(this.toucheds[e]=!1),t.buttons[14].pressed&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.MOVE,payload:{color:e,direction:_.LEFT}}})),t.buttons[13].pressed&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.MOVE,payload:{color:e,direction:_.DOWN}}})),t.buttons[15].pressed&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.MOVE,payload:{color:e,direction:_.RIGHT}}})),t.buttons[12].pressed&&document.dispatchEvent(new CustomEvent("action",{detail:{type:I.MOVE,payload:{color:e,direction:_.TOP}}}))})}};let j,z=new D;P.menu().then(t=>{(j=t).play()}),document.addEventListener("state",t=>{if(z.code!==t.detail.currentScreenCode)switch(t.detail.currentScreenCode){case"TITLE":z=new D;break;case"OPTIONS":z=new M;break;case"NEW_GAME":{j.pause();const e=H.initWalls(t.detail.map,t.detail.characters),a=H.initBonus(t.detail.map,t.detail.characters);document.dispatchEvent(new CustomEvent("action",{detail:{type:I.INIT_GAME,payload:{status:T.IN_PROGRESS,walls:e,bonus:a}}})),z=new U(t.detail.map,e,t.detail.characters,a)}}});const q=()=>{z.update(K),X.listen(),requestAnimationFrame(q)};requestAnimationFrame(q);const J={width:0,height:0,computedWidth:function(){return J.width},computedHeight:function(){return J.height}},Q=()=>{J.width=document.body.offsetWidth,J.height=document.body.offsetHeight,Y.style.width=J.computedWidth()+"px",Y.style.height=J.computedHeight()+"px"};Q(),window.addEventListener("resize",Q,!1)}]);
//# sourceMappingURL=main.js.map